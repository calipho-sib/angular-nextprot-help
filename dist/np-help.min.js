!function(a){"use strict";var b={zenEdit:!1,helpTitle:"Main articles",helpPath:"/nextprot-api/rdf/help/type/all.json",root:"",githubRepo:"aerobatic/markdown-content",githubApi:"https://api.github.com/repos/",githubToken:"2e36ce76cfb03358f0a38630007840e7cb432a24"};a.module("npHelp",["ngRoute"]).constant("settings",angular.extend(b,npHelpSettings||{}))}(angular),function(a,b){"use strict";function c(a,c,d,e,f,g,h){a.entityName=f.current&&f.current.params.entity||"",a.entity={},a.settings=e,a.rdfHelp=d,a.docGeneralities=[],a.docHelp=[],a.$on("$routeChangeStart",function(c,d,e){a.entity=={},a.entityName=b,d&&d.params&&d.params.entity&&(a.entity=a.getActiveElement(d.params.entity),a.entityName=d.params.entity),h.info("entityName",a.entityName),h.info("entity",a.entity)}),a.getActiveElement=function(b){for(var c in a.rdfHelp)if(a.rdfHelp[c].typeName===":"+b)return a.rdfHelp[c]},a.isActiveDoc=function(a){return a?c.path()&&-1!==c.path().indexOf(a||"-"):"/"===c.path()},a.isActiveElement=function(b){b=(b||"").replace(":","");var c=a.entityName===b;return c},a.hrefBuild=function(a){return a=a.replace(":",""),e.root&&e.root.length?e.root+"/"+a:a},a.initHelp=function(){d.query().$promise.then(function(b){return a.entity=a.getActiveElement(a.entityName),g.contentIndex()}).then(function(b){a.docGeneralities=b.docGeneralities,a.docHelp=b.docHelp})}}function d(a,b,c,d,e,f,g,h,i){a.article=d.article,h.contentIndex().then(function(b){if(d.article){var f=h.find(d.article);if(!f)return c.path("404").replace();var g=f.title.charAt(0).toUpperCase()+f.title.slice(1);g=g.replace(/-/g," "),_.find(b.docGeneralities,{slug:f.slug})?(e[0].title="RDF Help | "+g,a.docGeneralities=f):_.find(b.docHelp,{slug:f.slug})?(e[0].title="Help | "+g,a.docHelp=f):_.find(b.pages,{slug:f.slug})&&(e[0].title="Docs | "+g,a.pages=f)}})}a.module("npHelp").controller("HelpCtrl",c).controller("DocCtrl",d),c.$inject=["$scope","$location","rdfHelp","settings","$route","gitHubContent","$log"],d.$inject=["$scope","$rootScope","$location","$routeParams","$document","$sce","$log","gitHubContent","settings"]}(angular),function(a,b){"use strict";function c(a){a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase();for(var b="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;",c="aaaaaeeeeeiiiiooooouuuunc------",d=0,e=b.length;e>d;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));return a=a.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function d(a,b,c){var d=function(){this.$dao={rdfHelp:a(c.helpPath)},this.ready=!1,this.$promise=b.when(this)};return d.prototype.query=function(){var a=this;return this.ready||(this.$promise=a.$dao.rdfHelp.query().$promise,this.$promise.then(function(b){angular.extend(a,b),a.ready=!0})),this},new d}function e(a,d,e,f,g){function h(a){var d={blogPosts:[],docGeneralities:[],docHelp:[],pages:[]};return b.each(a,function(a){if("blob"===a.type){var b=a.path.split("/");if("blog"===b[0]){var e=b[4].strLeftBack("."),f=c(e);d.blogPosts.push({date:new Date(parseInt(b[1]),parseInt(b[2])-1,parseInt(b[3])),title:e,sha:a.sha,gitPath:a.path,titleSlug:f,urlPath:g.root+"/"+b.slice(0,4).concat(f).join("/")})}else if("generalities"===b[0]){var h=b[1].split("_"),i=h[1].strLeftBack("."),j=c(i);d.docGeneralities.push({title:i,slug:j,sequence:h[0],gitPath:a.path,urlPath:g.root+"/doc/"+j})}else if("help"===b[0]){var k=b[1].strLeftBack("."),j=c(k);d.docHelp.push({title:k,slug:j,gitPath:a.path,urlPath:g.root+"/help/"+j})}else if("pages"===b[0]){var k=b[1].strLeftBack("."),j=c(k);d.pages.push({title:k,slug:j,gitPath:a.path,urlPath:j})}}}),d.blogPosts=b.sortBy(d.blogPosts,"date").reverse(),d.docGeneralities=b.sortBy(d.docGeneralities,"sequence"),d}var i,j=g.githubApi+g.githubRepo,k="access_token="+g.githubToken,l=e.defer(),m={};return{initialize:function(a){angular.extend(g,a),j=g.githubApi+g.githubRepo,k="access_token="+g.githubToken;var b=j+"/git/trees/master?recursive=1";g.githubToken&&null!=g.githubToken&&(b+="&"+k),d.get(b).success(function(a){i=h(a.tree),f.info("github index",i),l.resolve(i)}).error(function(a){l.reject(a),f.error("Error initializing content index",a)})},contentIndex:function(){return l.promise},find:function(a){if(!i)return"";var c=b.find(i.docGeneralities,{slug:a});if(c)return c;var c=b.find(i.docHelp,{slug:a});return c?c:b.find(i.pages,{slug:a})},loadSlug:function(a){if(m[a])return m[a].promise;var b=this;return this.contentIndex().then(function(c){var d=b.find(a);return b.load(d)})},load:function(a){if(!a)return e.when("");var b=j+"/contents/"+a.gitPath+"?"+k,c={Accept:"application/vnd.github.VERSION.raw"};return m[a.slug]?m[a.slug].promise:(m[a.slug]=e.defer(),f.debug("fetching markdown content",b),d({method:"GET",url:b,headers:c}).success(function(b){f.info("Content received ",b.length),m[a.slug].resolve(b)}).error(function(b){f.error("Error returned from API proxy",b),m[a.slug].reject(b)}),m[a.slug].promise)}}}a.module("npHelp").factory("rdfHelp",d).factory("gitHubContent",e),String.prototype.strLeftBack=function(a){var b=this.lastIndexOf(a),c=this.substring(0,b);return c},d.$inject=["$resource","$q","settings"],e.$inject=["$rootScope","$http","$q","$log","settings"]}(angular,_),function(a,b){"use strict";a.module("npHelp").directive("rdfHelp",[function(){return{restrict:"A",transclude:!0,templateUrl:"html/np-help.element.html",link:function(a,b,c,d){}}}]).directive("helpToc",[function(){return{restrict:"E",transclude:!0,templateUrl:"html/np-help.toc.html",link:function(a,b,c,d){}}}]).directive("markdown",["$compile","$http","$parse","$sce","gitHubContent",function(a,b,c,d,e){function f(a,b){try{a.html(b)}catch(c){}a.find("table").addClass("table table-bordered"),angular.forEach(a.find("a"),function(a){a=angular.element(a),/^http[s]?\:\/\//.test(a.attr("href"))&&(a.addClass("external"),a.attr("target","external"))})}var g=new Showdown.converter;return{restrict:"E",scope:{mdSrc:"@"},replace:!0,link:function(a,h,i){var j=c(i.markdownOpts||{});i.mdSrc?i.$observe("mdSrc",function(a,c){b.get(i.mdSrc).then(function(a){h.html(g.makeHtml(a.data))},function(a){return j.silent?h.hide():void h.html(a)})}):i.markdownContent?i.$observe("markdownContent",function(a){f(h,g.makeHtml(a))}):i.markdownArticle?i.$observe("markdownArticle",function(a){a&&e.loadSlug(a).then(function(a){f(h,d.trustAsHtml(g.makeHtml(a)).toString())})}):h.html(g.makeHtml(h.text()))}}}]).directive("editMarkdown",["gitHubContent","settings",function(a,b){var c="http://github.com/",d="";return{restrict:"A",link:function(e,f,g,h){f.click(function(){b.zenEdit&&(d="#fullscreen_blob_contents"),a.contentIndex().then(function(e){var f=a.find(g.editMarkdown);b.githubEditPage?window.location.href=b.githubEditPage+f.gitPath+d:window.location.href=c+b.githubRepo+"/edit/master/"+f.gitPath+d})})}}}]).filter("cleanType",["$sce",function(a){return function(a,b){return a&&"object"!=typeof a?(a=a.replace(":",""),b&&(a=a.toLowerCase()),a):a}}]).filter("objectToArray",function(){return function(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b}})}(angular),angular.module("npHelp").run(["$templateCache",function(a){a.put("html/np-help.doc.html",'<div ng-controller="DocCtrl"> <markdown markdown-article="{{article}}"></markdown> <div class="clearfix gh-page-improve gh-page-{{article}}"> <hr/> <button class="btn btn-primary pull-right" edit-markdown="{{article}}">Improve this page</button> </div> </div> '),a.put("html/np-help.element.html",'<div class="row offset1"> <div class="row"> <section id="{{entity.typeName}}"> <h2> {{entity.typeName|cleanType}}  <div ng-if="entity.values.length> 0" class="btn-group"> <button class="btn dropdown-toggle" data-toggle="dropdown">Values<span class="caret"></span> </button> <ul class="dropdown-menu"> <li ng-repeat="value in entity.values"><a href="">{{value}}</a></li> </ul> </div> <span class="badge badge-info">{{entity.instanceCount}}</span> </h2> <blockquote> {{entity.rdfsComment}} </blockquote> <div class="row"> <div class="col-xs-12 col-md-5 vertical-middle "> <div ng-repeat="parent in entity.parentTriples | filter : rdfHelp.triples.predicate"> <p><code><a ng-href="{{hrefBuild(\'entity/\'+parent.subjectType)}}" class="text-info">{{parent.subjectType}}</a></code> &nbsp; <code class="text-warning">{{parent.predicate}}</code></span> </p> </div> </div> <div class="col-xs-12 col-md-7 form-inline"> <div class="panel panel-default"> <div class="panel-heading"><h5 class="text-center">{{entity.typeName}}</h5></div> <div class="panel-body"> <div ng-repeat="t in entity.triples | filter : rdfHelp.triples.predicate"> <code class="text-warning">{{t.predicate}}</code> <code><a class="text-success" ng-href="{{hrefBuild(\'entity/\'+t.objectType)}}">{{t.objectType}}</a></code> &nbsp; <span class="label label-info">{{t.tripleCount}}</span> <select ng-if="t.literalType && t.values.length> 1" class="form-control"> <option ng-repeat="value in t.values" value="{{value}}">{{value}}</option> </select> <input ng-if="t.literalType && t.values.length==1" type="text" placeholder="{{t.values[0]}}" class="form-control"></input> </div> </div> </div> </div> </div> <div class="bs-docs-example"> <div ng-repeat="t in entity.triples | filter : rdfHelp.triples.predicate"> <code class="text-info">{{t.tripleSample}}</code> </div> </div> <div class="bs-docs-example"> <div ng-repeat="path in entity.pathToOrigin"> <code class="text-info">{{path}} ?statement</code> </div> </div> </section> </div> </div>'),a.put("html/np-help.toc.html",'<ul class="nav nav-sidebar"> <li><h5>{{settings.helpTitle}}</h5></li> <li ng-repeat="article in docGeneralities" ng-class="{\'active\':isActiveDoc(article.urlPath)}"><a ng-href="{{article.urlPath}}">{{article.title}}</a></li> <li><h5>RDF Entities</h5></li> <li ng-repeat="rh in (rdfHelp | objectToArray) | orderBy:\'typeName\' | filter : rdfHelp.triples.predicate track by $index" ng-class="{\'active\':isActiveElement(rh.typeName)}" ng-if="rh.typeName"> <a ng-href="{{hrefBuild(\'entity/\'+rh.typeName)}}">{{rh.typeName|cleanType}} ({{rh.instanceCount}})</a> </li> </ul>')}]);
//# sourceMappingURL=./dist/np-help.map